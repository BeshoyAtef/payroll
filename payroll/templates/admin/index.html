{% extends "admin/base_site.html" %}
{% load i18n admin_static admin_views %}

{% block extrastyle %}{{ block.super }}
<script type="text/javascript" src="{% static "js/jquery-1.9.1.min.js" %}" ></script>
<script type="text/javascript" src="{% static "js/jquery.easing.1.3.js" %}"></script>
<script type="text/javascript" src="{% static "js/cufon-yui.js" %}"></script>
<script type="text/javascript" src="{% static "js/ChunkFive_400.font.js" %}"></script>
<link rel="stylesheet" type="text/css" href="{% static "admin/css/dashboard.css" %}" />
<link rel="stylesheet" type="text/css" href="{% static "css/jquerytour.css" %}" />
<link rel="stylesheet" type="text/css" href="{% static "css/style.css" %}" />
{% endblock %}

{% block coltype %}colMS{% endblock %}

{% block bodyclass %}dashboard{% endblock %}

{% block breadcrumbs %}{% endblock %}

{% block branding %}
  <h1 style="font-weight: bold;" id="site-name">{% trans 'Innov Payroll' %}</h1>
{% endblock %}

{% block content %}
<div id="content-main" style="margin-left: auto;
    margin-right: auto">

{% if app_list %}
    {% for app in app_list %}
        <div class="module">
        <table summary="{% blocktrans with name=app.name %}Models available in the {{ name }} application.{% endblocktrans %}">
        <caption><a href="{{ app.app_url }}" class="section">{% blocktrans with name=app.name %}{{ name }}{% endblocktrans %}</a></caption>
        {% for model in app.models %}
            <div 
style="
width: 120px;
-webkit-border-radius: 3px 3px 0 0;
-moz-border-radius: 3px 3px 0 0;
-ms-border-radius: 3px 3px 0 0;
-o-border-radius: 3px 3px 0 0;
overflow: hidden;
background: rgba(238, 238, 238, 0.38);
display: inline-block;
position: relative;
margin: 10px;
padding: 5px;
border-radius: 3px;
-webkit-box-shadow: 0 1px 3px 0 rgba(0,0,0,0.33);
-moz-box-shadow: 0 1px 3px 0 rgba(0,0,0,0.33);
box-shadow:1px 3px  3px 0 rgba(0,0,0,0.33);
}">

            {% if model.admin_url %}
                <center><a href="{{ model.admin_url }}"><h3 class="{{model.name}}">{{ model.name }}</h3></a></center>
            {% else %}
                <th scope="row">{{ model.name }}</th>
            {% endif %}

            {% if model.add_url %}
                 <span style="float:left;"><a href="{{ model.add_url }}" class="addlink">{% trans 'Add' %}</a></span>
            {% else %}
                <td>&nbsp;</td>
            {% endif %}

            {% if model.admin_url %}
                <span style="float:right;"><a href="{{ model.admin_url }}" class="changelink">{% trans 'Change' %}</a></span>
            {% else %}
                <td>&nbsp;</td>
            {% endif %}

            </div>
        {% endfor %}
        {% get_admin_views app.name %}
        </table>
        </div>
    {% endfor %}
{% else %}
    <p>{% trans "You don't have permission to edit anything." %}</p>
{% endif %}
</div>
{% endblock %}

{% block sidebar %}
<div id="content-related">
    <div class="module" id="recent-actions-module">
        <h2>{% trans 'Recent Actions' %}</h2>
        <h3>{% trans 'My Actions' %}</h3>
            {% load log %}
            {% get_admin_log 10 as admin_log for_user user %}
            {% if not admin_log %}
            <p>{% trans 'None available' %}</p>
            {% else %}
            <ul class="actionlist">
            {% for entry in admin_log %}
            <li class="{% if entry.is_addition %}addlink{% endif %}{% if entry.is_change %}changelink{% endif %}{% if entry.is_deletion %}deletelink{% endif %}">
                {% if entry.is_deletion or not entry.get_admin_url %}
                    {{ entry.object_repr }}
                {% else %}
                    <a href="{{ entry.get_admin_url }}">{{ entry.object_repr }}</a>
                {% endif %}
                <br/>
                {% if entry.content_type %}
                    <span class="mini quiet">{% filter capfirst %}{% trans entry.content_type.name %}{% endfilter %}</span>
                {% else %}
                    <span class="mini quiet">{% trans 'Unknown content' %}</span>
                {% endif %}
            </li>
            {% endfor %}
            </ul>
            {% endif %}
    </div>
</div>
<script type="text/javascript">
            $(function() {
                /*
                the json config obj.
                name: the class given to the element where you want the tooltip to appear
                bgcolor: the background color of the tooltip
                color: the color of the tooltip text
                text: the text inside the tooltip
                time: if automatic tour, then this is the time in ms for this step
                position: the position of the tip. Possible values are
                    TL  top left
                    TR  top right
                    BL  bottom left
                    BR  bottom right
                    LT  left top
                    LB  left bottom
                    RT  right top
                    RB  right bottom
                    T   top
                    R   right
                    B   bottom
                    L   left
                 */
                var config = [
                    {
                        "name"      : "Config",
                        "bgcolor"   : "black",
                        "color"     : "white",
                        "position"  : "TL",
                        "text"      : "You can configure your global settings by clicking on config to configure the chech-buffer, check-in time, check-out time and holidays",
                        "time"      : 5000
                    },
                    {
                        "name"      : "Attendance.exceptions",
                        "bgcolor"   : "black",
                        "color"     : "white",
                        "text"      : "here you can add, view or delete any record in your database",
                        "position"  : "BL",
                        "time"      : 5000
                    },
                    {
                        "name"      : "Employees",
                        "bgcolor"   : "black",
                        "color"     : "white",
                        "text"      : "Here by clicking on Employees besides adding, editing or deleting any record you can generate payement slips and reports per employee",
                        "position"  : "TL",
                        "time"      : 5000
                    }
                ],
                //define if steps should change automatically
                autoplay    = false,
                //timeout for the step
                showtime,
                //current step of the tour
                step        = 0,
                //total number of steps
                total_steps = config.length;
                    
                //show the tour controls
                showControls();
                
                /*
                we can restart or stop the tour,
                and also navigate through the steps
                 */
                $('#activatetour').on('click',startTour);
                $('#canceltour').on('click',endTour);
                $('#endtour').on('click',endTour);
                $('#restarttour').on('click',restartTour);
                $('#nextstep').on('click',nextStep);
                $('#prevstep').on('click',prevStep);
                
                function startTour(){
                    $('#activatetour').remove();
                    $('#endtour,#restarttour').show();
                    if(!autoplay && total_steps > 1)
                        $('#nextstep').show();
                    showOverlay();
                    nextStep();
                }
                
                function nextStep(){
                    if(!autoplay){
                        if(step > 0)
                            $('#prevstep').show();
                        else
                            $('#prevstep').hide();
                        if(step == total_steps-1)
                            $('#nextstep').hide();
                        else
                            $('#nextstep').show();  
                    }   
                    if(step >= total_steps){
                        //if last step then end tour
                        endTour();
                        return false;
                    }
                    ++step;
                    showTooltip();
                }
                
                function prevStep(){
                    if(!autoplay){
                        if(step > 2)
                            $('#prevstep').show();
                        else
                            $('#prevstep').hide();
                        if(step == total_steps)
                            $('#nextstep').show();
                    }       
                    if(step <= 1)
                        return false;
                    --step;
                    showTooltip();
                }
                
                function endTour(){
                    step = 0;
                    if(autoplay) clearTimeout(showtime);
                    removeTooltip();
                    hideControls();
                    hideOverlay();
                }
                
                function restartTour(){
                    step = 0;
                    if(autoplay) clearTimeout(showtime);
                    nextStep();
                }
                
                function showTooltip(){
                    //remove current tooltip
                    removeTooltip();
                    
                    var step_config     = config[step-1];
                    var $elem           = $('.' + step_config.name);
                    
                    if(autoplay)
                        showtime    = setTimeout(nextStep,step_config.time);
                    
                    var bgcolor         = step_config.bgcolor;
                    var color           = step_config.color;
                    
                    var $tooltip        = $('<div class="tooltip" id="tour_tooltip"><p>'+step_config.text+'</p><span class="tooltip_arrow"></span>',{
                        id          : 'tour_tooltip',
                        className   : 'tooltip',
                        html        : '<p>'+step_config.text+'</p><span class="tooltip_arrow"></span>'
                    }).css({
                        'display'           : 'none',
                        'background-color'  : bgcolor,
                        'color'             : color
                    });
                    
                    //position the tooltip correctly:
                    
                    //the css properties the tooltip should have
                    var properties      = {};
                    
                    var tip_position    = step_config.position;
                    
                    //append the tooltip but hide it
                    $('#content-main').prepend($tooltip);
                    
                    //get some info of the element
                    var e_w             = $elem.outerWidth();
                    var e_h             = $elem.outerHeight();
                    var e_l             = $elem.offset().left;
                    var e_t             = $elem.offset().top;
                    
                    
                    switch(tip_position){
                        case 'TL'   :
                            properties = {
                                'left'  : e_l,
                                'top'   : e_t + e_h + 'px'
                            };
                            $tooltip.find('span.tooltip_arrow').addClass('tooltip_arrow_TL');
                            break;
                        case 'TR'   :
                            properties = {
                                'left'  : e_l + e_w - $tooltip.width() + 'px',
                                'top'   : e_t + e_h + 'px'
                            };
                            $tooltip.find('span.tooltip_arrow').addClass('tooltip_arrow_TR');
                            break;
                        case 'BL'   :
                            properties = {
                                'left'  : e_l + 'px',
                                'top'   : e_t - $tooltip.height() + 'px'
                            };
                            $tooltip.find('span.tooltip_arrow').addClass('tooltip_arrow_BL');
                            break;
                        case 'BR'   :
                            properties = {
                                'left'  : e_l + e_w - $tooltip.width() + 'px',
                                'top'   : e_t - $tooltip.height() + 'px'
                            };
                            $tooltip.find('span.tooltip_arrow').addClass('tooltip_arrow_BR');
                            break;
                        case 'LT'   :
                            properties = {
                                'left'  : e_l + e_w + 'px',
                                'top'   : e_t + 'px'
                            };
                            $tooltip.find('span.tooltip_arrow').addClass('tooltip_arrow_LT');
                            break;
                        case 'LB'   :
                            properties = {
                                'left'  : e_l + e_w + 'px',
                                'top'   : e_t + e_h - $tooltip.height() + 'px'
                            };
                            $tooltip.find('span.tooltip_arrow').addClass('tooltip_arrow_LB');
                            break;
                        case 'RT'   :
                            properties = {
                                'left'  : e_l - $tooltip.width() + 'px',
                                'top'   : e_t + 'px'
                            };
                            $tooltip.find('span.tooltip_arrow').addClass('tooltip_arrow_RT');
                            break;
                        case 'RB'   :
                            properties = {
                                'left'  : e_l - $tooltip.width() + 'px',
                                'top'   : e_t + e_h - $tooltip.height() + 'px'
                            };
                            $tooltip.find('span.tooltip_arrow').addClass('tooltip_arrow_RB');
                            break;
                        case 'T'    :
                            properties = {
                                'left'  : e_l + e_w/2 - $tooltip.width()/2 + 'px',
                                'top'   : e_t + e_h + 'px'
                            };
                            $tooltip.find('span.tooltip_arrow').addClass('tooltip_arrow_T');
                            break;
                        case 'R'    :
                            properties = {
                                'left'  : e_l - $tooltip.width() + 'px',
                                'top'   : e_t + e_h/2 - $tooltip.height()/2 + 'px'
                            };
                            $tooltip.find('span.tooltip_arrow').addClass('tooltip_arrow_R');
                            break;
                        case 'B'    :
                            properties = {
                                'left'  : e_l + e_w/2 - $tooltip.width()/2 + 'px',
                                'top'   : e_t - $tooltip.height() + 'px'
                            };
                            $tooltip.find('span.tooltip_arrow').addClass('tooltip_arrow_B');
                            break;
                        case 'L'    :
                            properties = {
                                'left'  : e_l + e_w  + 'px',
                                'top'   : e_t + e_h/2 - $tooltip.height()/2 + 'px'
                            };
                            $tooltip.find('span.tooltip_arrow').addClass('tooltip_arrow_L');
                            break;
                    }
                    
                    
                    /*
                    if the element is not in the viewport
                    we scroll to it before displaying the tooltip
                     */
                    var w_t = $(window).scrollTop();
                    var w_b = $(window).scrollTop() + $(window).height();
                    //get the boundaries of the element + tooltip
                    var b_t = parseFloat(properties.top,10);
                    
                    if(e_t < b_t)
                        b_t = e_t;
                    
                    var b_b = parseFloat(properties.top,10) + $tooltip.height();
                    if((e_t + e_h) > b_b)
                        b_b = e_t + e_h;
                        
                    
                    if((b_t < w_t || b_t > w_b) || (b_b < w_t || b_b > w_b)){
                        $('html, body').stop()
                        .animate({scrollTop: b_t}, 500, 'easeInOutExpo', function(){
                            //need to reset the timeout because of the animation delay
                            if(autoplay){
                                clearTimeout(showtime);
                                showtime = setTimeout(nextStep,step_config.time);
                            }
                            //show the new tooltip
                            $tooltip.css(properties).show();
                        });
                    }
                    else
                    //show the new tooltip
                        $tooltip.css(properties).show();
                }
                
                function removeTooltip(){
                    $('#tour_tooltip').remove();
                }
                
                function showControls(){
                    /*
                    we can restart or stop the tour,
                    and also navigate through the steps
                     */
                    var $tourcontrols  = '<div id="tourcontrols" class="tourcontrols">';
                    $tourcontrols += '<p>First time here?</p>';
                    $tourcontrols += '<span class="button" id="activatetour">Start the tour</span>';
                        if(!autoplay){
                            $tourcontrols += '<div class="nav"><span class="button" id="prevstep" style="display:none;">< Previous</span>';
                            $tourcontrols += '<span class="button" id="nextstep" style="display:none;">Next ></span></div>';
                        }
                        $tourcontrols += '<a id="restarttour" style="display:none;">Restart the tour</span>';
                        $tourcontrols += '<a id="endtour" style="display:none;">End the tour</a>';
                        $tourcontrols += '<span class="close" id="canceltour"></span>';
                    $tourcontrols += '</div>';
                    
                    $('BODY').prepend($tourcontrols);
                    $('#tourcontrols').animate({'right':'30px'},500);
                }
                
                function hideControls(){
                    $('#tourcontrols').remove();
                }
                
                function showOverlay(){
                    var $overlay    = '<div id="tour_overlay" class="overlay"></div>';
                    $('BODY').prepend($overlay);
                }
                
                function hideOverlay(){
                    $('#tour_overlay').remove();
                }
                
            });
</script>
{% endblock %}
